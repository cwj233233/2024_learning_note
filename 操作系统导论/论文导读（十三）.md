# HLC-PCP: A Resource Synchronization Protocol for Certifiable Mixed Criticality Scheduli

**HLC - PCP：一种用于可认证混合关键性调度的资源同步协议**

## 一、论文概括

当前MCS工作假设任务独立且不共享资源，这一假设具有局限性。因此，文章提出了HLC-PCP协议，它 **扩展了优先级天花板协议（PCP）** 以适用于AMC。HLC-PCP定义了任务的参数、信号量的相关属性以及作业调度规则，确保了高关键性任务所需的临界区能完成且不中止。文章还通过一个示例说明了协议的执行过程，并计算了最坏情况下的阻塞时间。最后，通过生成随机任务集对协议进行了性能评估，结果表明可调度性会随着CPU利用率和临界区长度的增加而降低，但在实际应用中，可调度性损失在可接受范围内。

## 二、HLC-PCP协议

### 2.1 协议定义

1. 任务的相关参数：包括固定名义优先级、活动优先级、固定名义临界性、活动临界性、使用的信号量集合等。
2. 信号量的属性：
   * LO-crit模式下的优先级上限：定义为在LO - crit模式下能锁定该信号量的任务的最高优先级。
   * HI-crit模式下的优先级上限：定义为在HI - crit模式下能锁定该信号量的任务的最高优先级，即名义临界性为HI的任务的最高优先级。
   * 动态优先级上限：等于能锁定该信号量的活动任务的最高优先级。
   * 常量临界性上限：等于所有可能锁定该信号量的任务的最高临界性。
3. 动态系统优先级上限：定义为当前由活动任务持有的所有信号量的最大动态优先级上限。

### 2.2 协议调度流程

1. 系统初始化时，临界性级别指示器为LO，系统处于LO-crit模式。
2. 在LO-crit模式下，每一瞬间选择具有最高活动优先级的任务生成的等待作业执行。
3. 如果当前执行的作业（来自任何任务）执行超过一定时间且某些LO-crit任务在保护与HI - crit任务共享资源的临界区内执行，则系统进入模式切换期间（Mode-Change Period）；这些任务在退出临界区时被丢弃；当没有更多活动的LO - crit任务时，系统进入HI-crit模式。
4. 一旦进入HI-crit模式，具有活动临界性的作业立即被丢弃。每一瞬间，选择具有最高活动优先级的具有活动临界性的任务生成的等待作业执行。
5. 任务进入临界区通过锁定信号量时，其活动临界性设置为信号量的最高锁定临界性；释放信号量后，恢复到锁定前的原始临界性值。
6. 任务要进入由信号量保护的临界区，必须具有比当前系统中除自身以外锁定的信号量中具有最高动态优先级上限的信号量更高的优先级。此外，如果低优先级任务持有信号量并阻塞了试图锁定该信号量的高优先级任务，则低优先级任务继承高优先级任务的活动优先级。

### 2.3 最坏阻塞时间计算

在最坏情况阻塞时间计算部分，作者根据任务的标称优先级和临界性值，将任务分为4类。阻塞分为传统的优先级反转阻塞（pi - blocking）和新的临界性反转阻塞（ci - blocking）。对于AMC任务集的可调度性分析，需要检查3种情况：

1. LO - crit模式：计算每个LO或HI - crit任务在LO - crit模式下的最大pi - 阻塞时间，通过计算能对该任务造成阻塞的最长临界区的长度来得到。
2. HI - crit模式：计算每个HI - crit任务在HI - crit模式下的最大pi - 阻塞时间，考虑来自高优先级任务的阻塞。
3. 模式切换期间：计算每个HI - crit任务在模式切换期间的最大pi - 阻塞时间和ci - 阻塞时间。通过确定能对任务造成ci - 阻塞的临界区集合，计算来自每个任务和每个信号量的最长临界区阻塞时间，最终得到总的ci - 阻塞时间。
   通过分类讨论和计算，得出了在不同模式下任务可能经历的最大阻塞时间，以用于可调度性分析。

## 三、结果分析

* 生成随机任务集，每个任务集包含20个任务，具有不同的CPU利用率和临界区长度。
* 实验结果表明，可调度性随着CPU利用率和临界区长度的增加而降低，对于临界区长度等于任务周期10％的情况，任务集CPU利用率高达80％时，可调度性损失在10％以内。



