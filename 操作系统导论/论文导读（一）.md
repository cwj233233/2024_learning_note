# Priority Inheritance Protocols: An Approach to Real-Time Synchronization

## 一、优先级反转问题

直接使用同步机制如Ada rendezvous、信号量或监视器可能导致无控制的优先级倒置，即**高优先级任务被低优先级任务无限期阻塞**。本文正式研究了优先级继承协议，这是一种解决无控制优先级倒置问题的同步原语优先级管理方案。

## 二、优先级继承协议

优先级继承协议（Priority Inheritance Protocol, PIP）是一种解决实时系统中任务优先级倒置问题的技术。当一个低优先级任务持有高优先级任务所需的关键资源时，就会发生优先级倒置。在PIP中，如果高优先级任务需要一个被低优先级任务占用的资源，该低优先级任务将暂时继承高优先级任务的优先级。这样，它可以更快地执行并释放资源，减少高优先级任务的等待时间，从而避免了无限优先级倒置的问题。

**核心思想：让低优先级任务尽快完成释放资源**

1. 下一个要使用的任务赋予最高优先级
2. 正在运行的低优先级任务赋予高优先级
3. 低优先级任务得到高优先级，运行结束后释放资源恢复原优先级（如果多个资源则继承未释放资源的最高优先级）



## 三、优先级最高限制协议

优先级最高限制协议是一种防止优先级倒置和死锁的同步策略。每个共享资源都被赋予一个限制最高优先级，它代表所有可能访问该资源的任务中最高的优先级。当一个任务开始使用这样的资源时，它的优先级将临时提升到该资源的限制的**最高优先级**。这有助于避免低优先级的任务阻塞高优先级任务，从而提升系统的效率和响应速度。任务使用完资源并释放后，其优先级将恢复到原始水平。这种机制确保了资源的有效管理和任务的顺畅执行。

**核心思想：让当前执行的任务优先级提高到最高限制等级**

## 四、对比

- 优先级继承协议（PIP）：当低优先级任务持有高优先级任务需要的资源时，该低优先级任务将暂时继承阻塞它的最高优先级任务的优先级。这意味着其优先级只在必要时提升，以便快速释放资源。

- 优先级最高限制协议（PCP）：为每个资源分配一个固定的最高优先级（称为优先级限制），当任何任务获取资源时，其优先级立即提升到这个固定的最高优先级。
- 执行效率：
    - 优先级继承协议可能需要多次调整拥有临界资源的任务的优先级，因为它只在需要时才提升低优先级任务的优先级。
    - 优先级最高限制协议在任务获得临界资源时一次性将优先级提升到最高，这样可以避免中途的多次优先级调整。
    - 
- 对程序运行过程的影响：
    - 优先级最高限制板协议通过提升任务优先级到最高，可能导致中优先级任务的完成时间延长，因为它阻止了这些任务在资源使用期间抢占资源。
    - 优先级继承协议只有在高优先级任务实际需要被阻塞的资源时，才提升低优先级任务的优先级，因此对任务的运行影响较小，更为灵活。